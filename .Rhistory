source("C:/Users/sdutton/Desktop/SamR/pkids/R/hello.R")
source("C:/Users/sdutton/Desktop/SamR/pkids/R/class_assignment_functions.R")
gc()
library(pkids)
hello()
get_mode()
?pkids
//pkids
??pkids
lea_ids
data("lea_ids")
library(pkids)
i=1
library(tidyverse)
library(data.table)
library(magrittr)
library(stringr)
lea_ids <- read_csv("H:/Economists/Ed/KIDS/All LEAs/District IDs Master.csv", col_types = cols())
closed <- c("ALIA","AMIN","ARST","CAPC","KAIR","PION")
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>%
filter(!lea_acronym %in% c(closed) )
# Load all of the database checks
source("H:/Economists/Ed/KIDS/All LEAs/Database/database checks functions.R")
i=1
charter_ids <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv")
closed <- c("ALIA","AMIN","ARST","CAPC","KAIR","PION")
charter_ids %<>% filter(!lea_acronym %in% c(closed))
charterChecks <- NULL
i_id <- charter_ids[i,] %>% mutate(lea_acronym = tolower(lea_acronym))
try(allocation <- fread(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_",version,"/allocation/z_",tolower(i_id$lea_acronym), "_class.txt"),
select = c(183:374,169)))
version <- "v4"
i_id <- charter_ids[i,] %>% mutate(lea_acronym = tolower(lea_acronym))
try(allocation <- fread(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_",version,"/allocation/z_",tolower(i_id$lea_acronym), "_class.txt"),
select = c(183:374,169)))
try(expense <- fread(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_",version,"/expense/z_",tolower(i_id$lea_acronym), "_expense.txt"),
select = c("lea_code", "fiscal_year", "total", "u_location","u_fund","u_function",
"Expense_Category", "u_program", "u_object", "subcode")))
try(charter_check <- data.frame("check1" = check1(expense),
"check2" = check2(expense),
"check3a" = check3a(expense, allocation),
"check3b" = check3b(expense, allocation),
"district" = i_id$lea_name))
try(charterChecks %<>% rbind(charter_check))
check_file <<- charterChecks
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," complete"))
print(paste0(charter_ids$lea_name[i]," is done. Number remaining: ",nrow(charter_ids) - i))
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," completen/n test"))
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," completen\n test"))
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," complete \n\n test"))
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," complete \n\n test"))
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," complete n/n test"))
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," complete /n/n test"))
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," complete test"))
print(paste0(charter_ids$lea_name[i]," is done. Number remaining: ",nrow(charter_ids) - i))
library(pkids)
library(pkids)
#### Pull file paths for CHARTER EXPENSE ####-------------------------------------------
charter_expense <- function(version){
path <- paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_", version,"/expense")
file_names <- as_tibble(list.files(path))
file_charters <- file_names %>% filter(str_detect(value,"^z"))
file_districts <- file_names %>% anti_join(file_charters)
file_charters$value <- toupper(gsub("_expense.txt|z_","",file_charters$value))
master_fileCHARTER <- NULL
for (i in 1:nrow(file_charters)){
charter_i <- charters %>% filter(str_detect(lea_acronym, file_charters$value[i]))
master_fileCHARTER %<>% rbind(charter_i)
rm(charter_i)
}
# Which are missing?
print(charters %>% anti_join(master_fileCHARTER) %>% select(lea_name))
rm(file_names, file_charters, file_districts, master_fileCHARTER)
}
install.packages("data.table")
library(pkids)
library(tidyverse)
library(data.table)
library(magrittr)
library(stringr)
library(pkids)
closed <- c("ALIA","AMIN","ARST","CAPC","KAIR","PION")
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>%
filter(!lea_acronym %in% c(closed) )
## ****UPDATE THIS EACH YEAR **** ##
version <- "v4"
## Missing Expense for Districts ##
district_expense(version)
## Missing Expense for Charters ##
charter_expense(version)
## Missing Allocation for Districts ##
district_allocation(version)
## Missing Allocation for Charters ##
charter_allocation(version)
#### CONFIRM THAT NO FILES WERE ACCIDENTALLY SENT TO THE WRONG VERSION ####
lea_ids$district_code <-  tolower(lea_ids$district_code)
# **** Set a date that roughly equates to when yearly updates were started **** #
basic <- "01/09/22"
threshold <- as.POSIXct(basic,
format = "%d/%m/%y")
confirm_district_expense_time_function()
confirm_charter_expense_time_function()
district_allocation_time_function()
charter_allocation_time_function()
version <- "v4"
# Expense - 40
charter_expense_columns()
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>% mutate(lea_acronym = tolower(lea_acronym))
closed <- c("ALIA","AMIN","ARST","CAPC","KAIR","PION")
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>%
filter(!lea_acronym %in% c(closed) )
master_data <- NULL
for(i in  1:nrow(charters)){
try(x <- ncol(fread(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_",version,"/expense/z_",charters$lea_acronym[i],"_expense.txt"), nrow = 0)))
if(exists("x")){
data_tibble <- as.data.frame(name = charters$lea_name[i],
number = x)
}
try(master_data %<>% rbind(data_tibble))
rm(i)
}
try(x <- ncol(fread(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_",version,"/expense/z_",charters$lea_acronym[i],"_expense.txt"), nrow = 0)))
if(exists("x")){
data_tibble <- as.data.frame(name = charters$lea_name[i],
number = x)
}
if(exists(x)){
data_tibble <- as.data.frame(name = charters$lea_name[i],
number = x)
}
try(x <- ncol(fread(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_",version,"/expense/z_",charters$lea_acronym[i],"_expense.txt"), nrow = 0)))
if(exists("x")){
data_tibble <- as.data.frame(name = charters$lea_name[i],
number = x)
}
data_tibble <- as.data.frame(name = charters$lea_name[i],
number = as.numeric(x))
x
data_tibble <- as.data.frame(name = charters$lea_name[i],
number = c(x))
data_tibble <- as.data.frame(name = charters$lea_name[i],
number = pull(x))
pull(x)
data_tibble <- as.data.frame(name = charters$lea_name[i],
number = list(x))
data_tibble <- as.data.frame(name = charters$lea_name[i],
number = x))
data_tibble <- as.data.frame(name = charters$lea_name[i],
number = x[]))
data_tibble <- as.data.frame(name = charters$lea_name[i],
number = x[1,]))
data_tibble <- as.data.frame(name = charters$lea_name[i],
number = x[1]))
data_tibble <- as.data.frame(name = charters$lea_name[i],
number = x[1])
data_tibble <- data.table(name = charters$lea_name[i],
number = x[1])
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>% mutate(lea_acronym = tolower(lea_acronym))
closed <- c("ALIA","AMIN","ARST","CAPC","KAIR","PION")
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>%
filter(!lea_acronym %in% c(closed) )
master_data <- NULL
for(i in  1:nrow(charters)){
try(x <- ncol(fread(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_",version,"/expense/z_",charters$lea_acronym[i],"_expense.txt"), nrow = 0)))
if(exists("x")){
data_tibble <- data.table(name = charters$lea_name[i],
number = x)
}
try(master_data %<>% rbind(data_tibble))
rm(i)
}
data <- as.data.frame(name = charters$lea_name[i],
date = x)
data <- data.frame(name = charters$lea_name[i],
date = x)
i=1
data <- data.frame(name = charters$lea_name[i],
date = x)
x <- as.Date(file.info(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_v3/allocation/z_",charters$lea_acronym[i],"_class.txt"))$mtime)
x <- as.POSIXct(x)
data <- data.frame(name = charters$lea_name[i],
date = x)
data %<>% mutate(correct = ifelse(data$date < threshold,"Correct","FALSE"))
charter_allocation_time %<>% rbind(data)
charter_allocation_time <- NULL
charter_allocation_time <- NULL
# Check charter allocation
for(i in 1:nrow(charters)){
x <- as.Date(file.info(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_v3/allocation/z_",charters$lea_acronym[i],"_class.txt"))$mtime)
x <- as.POSIXct(x)
data <- data.frame(name = charters$lea_name[i],
date = x)
data %<>% mutate(correct = ifelse(data$date < threshold,"Correct","FALSE"))
charter_allocation_time %<>% rbind(data)
}
View(charter_allocation_time)
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>% mutate(lea_acronym = tolower(lea_acronym))
closed <- c("ALIA","AMIN","ARST","CAPC","KAIR","PION")
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>%
filter(!lea_acronym %in% c(closed) )
master_data <- NULL
data_tibble <- data.frame(name = charters$lea_name[i],
number = x)
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>% mutate(lea_acronym = tolower(lea_acronym))
closed <- c("ALIA","AMIN","ARST","CAPC","KAIR","PION")
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>%
filter(!lea_acronym %in% c(closed) )
master_data <- NULL
try(x <- ncol(fread(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_",version,"/expense/z_",charters$lea_acronym[i],"_expense.txt"), nrow = 0)))
if(exists("x")){
data_tibble <- data.frame(name = charters$lea_name[i],
number = x)
}
try(master_data %<>% rbind(data_tibble))
View(master_data)
charter_expense_columns <- function(version){
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>% mutate(lea_acronym = tolower(lea_acronym))
closed <- c("ALIA","AMIN","ARST","CAPC","KAIR","PION")
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>%
filter(!lea_acronym %in% c(closed) )
master_data <- NULL
for(i in  1:nrow(charters)){
try(x <- ncol(fread(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_",version,"/expense/z_",charters$lea_acronym[i],"_expense.txt"), nrow = 0)))
if(exists("x")){
data_tibble <- data.frame(name = charters$lea_name[i],
number = x)
}
try(master_data %<>% rbind(data_tibble))
rm(i)
}
print(master_data %>% filter(number != 40))
}
# Expense - 40
charter_expense_columns()
version <- "v4"
# Expense - 40
charter_expense_columns()
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>% mutate(lea_acronym = tolower(lea_acronym))
closed <- c("ALIA","AMIN","ARST","CAPC","KAIR","PION")
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>% mutate(lea_acronym = tolower(lea_acronym))
closed <- c("ALIA","AMIN","ARST","CAPC","KAIR","PION")
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>%
filter(!lea_acronym %in% c(closed) )
master_data <- NULL
for(i in  1:nrow(charters)){
try(x <- ncol(fread(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_",version,"/expense/z_",charters$lea_acronym[i],"_expense.txt"), nrow = 0)))
if(exists("x")){
data_tibble <- data.frame(name = charters$lea_name[i],
number = x)
}
try(master_data %<>% rbind(data_tibble))
rm(i)
}
# Expense - 40
charter_expense_columns(version)
library(pkids)
library(pkids)
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv", col_types = cols())
charters <- read.csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv", col_types = cols())
charters <- read.csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv")
save(charters)
usethis::use_data(charters)
charter_ids <- read.csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv")
usethis::use_data(charter_ids)
library(pkids)
