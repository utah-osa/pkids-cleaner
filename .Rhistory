source("C:/Users/sdutton/Desktop/SamR/pkids/R/hello.R")
source("C:/Users/sdutton/Desktop/SamR/pkids/R/class_assignment_functions.R")
gc()
library(pkids)
hello()
get_mode()
?pkids
//pkids
??pkids
lea_ids
data("lea_ids")
library(pkids)
i=1
library(tidyverse)
library(data.table)
library(magrittr)
library(stringr)
lea_ids <- read_csv("H:/Economists/Ed/KIDS/All LEAs/District IDs Master.csv", col_types = cols())
closed <- c("ALIA","AMIN","ARST","CAPC","KAIR","PION")
charters <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv") %>%
filter(!lea_acronym %in% c(closed) )
# Load all of the database checks
source("H:/Economists/Ed/KIDS/All LEAs/Database/database checks functions.R")
i=1
charter_ids <- read_csv("H:/Economists/Ed/KIDS/All Charter Schools/All/Charter IDs Master.csv")
closed <- c("ALIA","AMIN","ARST","CAPC","KAIR","PION")
charter_ids %<>% filter(!lea_acronym %in% c(closed))
charterChecks <- NULL
i_id <- charter_ids[i,] %>% mutate(lea_acronym = tolower(lea_acronym))
try(allocation <- fread(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_",version,"/allocation/z_",tolower(i_id$lea_acronym), "_class.txt"),
select = c(183:374,169)))
version <- "v4"
i_id <- charter_ids[i,] %>% mutate(lea_acronym = tolower(lea_acronym))
try(allocation <- fread(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_",version,"/allocation/z_",tolower(i_id$lea_acronym), "_class.txt"),
select = c(183:374,169)))
try(expense <- fread(paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_",version,"/expense/z_",tolower(i_id$lea_acronym), "_expense.txt"),
select = c("lea_code", "fiscal_year", "total", "u_location","u_fund","u_function",
"Expense_Category", "u_program", "u_object", "subcode")))
try(charter_check <- data.frame("check1" = check1(expense),
"check2" = check2(expense),
"check3a" = check3a(expense, allocation),
"check3b" = check3b(expense, allocation),
"district" = i_id$lea_name))
try(charterChecks %<>% rbind(charter_check))
check_file <<- charterChecks
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," complete"))
print(paste0(charter_ids$lea_name[i]," is done. Number remaining: ",nrow(charter_ids) - i))
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," completen/n test"))
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," completen\n test"))
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," complete \n\n test"))
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," complete \n\n test"))
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," complete n/n test"))
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," complete /n/n test"))
print(paste0("You are ", scales::label_percent()(i/nrow(charter_ids))," complete test"))
print(paste0(charter_ids$lea_name[i]," is done. Number remaining: ",nrow(charter_ids) - i))
library(pkids)
library(pkids)
#### Pull file paths for CHARTER EXPENSE ####-------------------------------------------
charter_expense <- function(version){
path <- paste0("H:/Economists/Ed/KIDS/All LEAs/Database/exports_", version,"/expense")
file_names <- as_tibble(list.files(path))
file_charters <- file_names %>% filter(str_detect(value,"^z"))
file_districts <- file_names %>% anti_join(file_charters)
file_charters$value <- toupper(gsub("_expense.txt|z_","",file_charters$value))
master_fileCHARTER <- NULL
for (i in 1:nrow(file_charters)){
charter_i <- charters %>% filter(str_detect(lea_acronym, file_charters$value[i]))
master_fileCHARTER %<>% rbind(charter_i)
rm(charter_i)
}
# Which are missing?
print(charters %>% anti_join(master_fileCHARTER) %>% select(lea_name))
rm(file_names, file_charters, file_districts, master_fileCHARTER)
}
install.packages("data.table")
library(pkids)
